<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>test</title>
    <link rel="stylesheet" type="text/css" href="style.css" media="screen"/>
  </head>
  <body>
    <div style="display: flex; justify-content: center;">
      <div style="display: flex; flex-direction: column; width: 400px;">
        <div style="width: 100%;">
          <h4>Monto a prestar</h4>
          <input type="text" id="amount" value="500" style="width: 100%;font-size: 24px;text-align: center;">
          <h4>Tasa de interés</h4>
          <input type="text" id="TIO" value="13.5" style="width: 100%;font-size: 24px;text-align: center;">
          <input type="button" name="" value="Simular" onclick="solve()" style="margin-top: 32px; width: 100%; font-size: 24px;text-align: center;">
        </div>
        <h4>
        <table id='test' style="text-align: right; width: 100%; margin-top: 32px">
          <tr>
            <th>Plazo</th>
            <th>Ganancia</th>
          </tr>
        </table>
      </h4>
      </div>
      </div>
    <div>
      <table>
        <tr>
          <th>Meses</th>
          <th>Pago Mensual</th>
          <th>Comisión de Apertura</th>
          <th>Monto Neto Depositado</th>
          <th>Total Pagado</th>
          <th>Intereses Pagados</th>
          <th>CAT</th>
        </tr>
      </table>
    </div>
    <script type="text/javascript">
      function PMT(ir, np, pv, fv, type) {
        /*
        * ir   - interest rate per month
        * np   - number of periods (months)
        * pv   - present value
        * fv   - future value
        * type - when the payments are due:
        *        0: end of the period, e.g. end of month (default)
        *        1: beginning of period
        */
        var pmt, pvif;

        fv || (fv = 0);
        type || (type = 0);

        if (ir === 0)
        return -(pv + fv)/np;

        pvif = Math.pow(1 + ir, np);
        pmt = - ir * pv * (pvif + fv) / (pvif - 1);

        if (type === 1)
        pmt /= (1 + ir);

        return pmt;
      }

      const lending = 5000//Number(document.getElementById("amount").value) //MONTO DEL PRESTAMO
      const TIO = 13.5/100//Number(document.getElementById("TIO").value) //TASA DE INT ORDINARIO
    //const month = fields.approvedCredit.term //PLAZO
      const TIVA = 0.16 //TASA IVA
      const commission = 0.001 //COMISIÓN PLATAFORMO
      //DATOS INICIALES CALCULADOS
      const TIIVA = TIO * (1 + TIVA) //tasa de int con IVA
      const TIM = TIO/12 //Tasa de interes mensual
      const TIMIVA = TIIVA/12//Tasa de interes mensual con IVA
      const commissionIVA = commission * 1.16// IVA COMISION
      //const cuotaMensual = -PMT(TIMIVA, month, lending)

      let saldo = 0
      let interes = 0
      let ivaInt = 0
      let abonoCapital = 0
      let saldoInicial = lending
      let mensualidad = 0

      for (let i = 6; i <= 48; i++) {
        const cuotaMensual = -PMT(TIMIVA, i, lending)
        saldoInicial = saldoInicial - abonoCapital
        saldo = Math.round(saldoInicial)
        interes = Math.round(saldo) * TIM.toFixed(5)
        ivaInt = Math.round(interes) * 0.16
        abonoCapital = cuotaMensual - interes - ivaInt
        let platformCommission = lending * commission
        let ivaCommission = platformCommission * 0.16
        let saldoFinal = saldo - Math.round(abonoCapital)
        mensualidad = interes + abonoCapital + platformCommission + ivaInt + ivaCommission
        i+5
        console.log('mensualidad '+mesualidad)
      }

    </script>
    <script>
      function solve() {
        const amount = Number(document.getElementById("amount").value)
        const TIO = Number(document.getElementById("TIO").value)
        let i = 6

        for(i; i <= 48; i++) {
          var btn = $("<tr/>");
          var h1 = $('<td/>')
          h1.html( i + ' meses')
          var h2 = $('<td/>')
          let gain = amount * (i/12) * (TIO/100)
          h2.html(gain.toLocaleString())
          btn.append(h1)
          btn.append(h2)
          $('#test').append(btn);
          i+=5
        }
      }
    </script>
    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous">
    </script>
  </body>
</html>
